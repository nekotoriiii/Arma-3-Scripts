#!/usr/bin/env bash
set -e
set -o pipefail
WORKSHOP_ITEMS=(
    166907884
    167274881
    173478248
    175551490
    183397120
    184917782
    187951083
    195617187
    195806552
    195807624
    197205299
    200343648
    200512997
    205306913
    208775172
    209197322
    215729874
    219531730
    223250600
    240231154
    252855752
    261097923
    280394787
    286244039
    302765256
    303340621
    308038160
    330969639
    332669951
    333310405
    349220853
    360097028
    378941393
    383397522
    392996862
    394169636
    410206202
    410243478
    421839251
    421908020
    433613841
    437532639
    448333775
    450814997
    457905859
    463939057
    476065334
    497660133
    497661914
    498101407
    501966277
    502277724
    541888371
    545094808
    546510917
    549676314
    581323190
    583496184
    583544987
    620019431
    621650475
    623475643
    659475664
    660460283
    671539540
    690552013
    696414736
    696633378
    697875816
    705986840
    708250744
    717617261
    718871710
    722648525
    722675841
    727184190
    729834202
    735566597
    738765512
    744014140
    753769040
    756352410
    760130551
    761149851
    766710275
    767416754
    769440155
    773125288
    773131200
    773314286
    773759919
    779568775
    782198044
    812046730
    816114672
    822378563
    825179978
    825222328
    825786106
    828493030
    843133445
    843425103
    843577117
    843593391
    843632231
    853743366
    854964321
    861133494
    865203162
    865662937
    876774326
    884966711
    891433622
    925018569
    930264602
    931494263
    932255884
    937438041
    940922712
    943001311
    944356711
    944723712
    946763963
    947704792
    950999958
    952545851
    953118282
    966254425
    969904308
    971617925
    1113631358
    1119901195
    1128256978
    1188797395
    1208517358
    1229196780
    1255799133
    1267657613
    1292849613
    1298282761
    1308443165
    1310092312
    1334412770
    1362357927
    1368857262
    1375890861
    1376636636
    1377912885
    1378046829
    1379304937
    1414426283
    1420266916
    1453853092
    1462782912
    1487484880
    1496363537
    1507586063
    1532504745
    1544618724
    1556296528
    1562915006
    1606871585
    1624803912
    1624804924
    1630816076
    1638341685
    1655727065
    1657493558
    1658815029
    1660210110
    1665585720
    1671174248
    1757672655
    1758348955
    1766664874
    1768992669
    1777715003
    1803586009
    1832665647
    1842439195
    1848649183
    1858075458
    1876077456
    1883956552
    1910457930
    1926513010
    1981964169
    1984426259
    2030278282
    2043771912
    2057294714
    2060770170
    2068033599
    2129532219
    2162749089
    2162811561
    2174495332
    2185874952
    2187272188
    2193296534
    2193322331
    2198339170
    2207328876
    2237237325
    2262255106
    2291305691
    2292870524
    2361949884
    2366701987
    2369477168
    2461406717
    2466979580
    2467589125
    2467590475
)

START_FROM=0
ONLY=0

if [[ -n "$1" ]]; then
    found=0
    for workshop_item in ${WORKSHOP_ITEMS[@]}; do
        if [[ $1 -eq $workshop_item ]]; then
            found=1
            break
        fi
    done
    if [[ $found -eq 1 ]]; then
        echo "Starting from $1"
        START_FROM=$1
        if [[ $2 -eq "--only" ]]; then
            ONLY=1
        fi
    else
        echo "Provided workshop id $1 is not in list"
    fi
fi

found_start=0

for workshop_item in ${WORKSHOP_ITEMS[@]}; do
    if [[ $START_FROM -ne 0 ]]; then
        if [[ $found_start -eq 0 && $workshop_item -ne $START_FROM ]]; then
            continue
        elif [[ $workshop_item -eq $START_FROM ]]; then
            found_start=1
        fi
    fi

    steamcmd +login lasso133 +force_install_dir ./_mods/mods_caseinsensitive +workshop_download_item 107410 ${workshop_item} validate +quit | egrep "^(Downloading item ${workshop_item} ...|Success. Downloaded item ${workshop_item})"
    if [[ $ONLY -eq 1 ]]; then
        break
    fi
done